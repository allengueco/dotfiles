" Packages {{{
packadd lsp
packadd onedark
" }}}

" Options {{{
colorscheme onedark 
set number
set autoindent
set smartindent
set hidden 
set backspace=indent,eol,start
set nocp
set relativenumber number
set grepprg=rg\ --vimgrep\ --smart-case\ --follow
filetype plugin indent on
syntax enable
set scrolloff=10
set nowrap
set showcmd
set showmode
set wildmenu
set wildignore=*.docx,*.jpg,*.png,*.gif,*.pdf,*.pyc,*.exe,*.flv,*.img,*.xlsx
set shiftwidth=4
set tabstop=4
set expandtab

let mapleader=" "
" }}}


" Navigation rebind {{{
nnoremap <C-f> :Files<CR>
nnoremap <leader>b :Buffers<CR>
nnoremap <leader>f :Rg<CR>
nnoremap <leader>/ :BLines<CR>
nnoremap <leader>' :Marks<CR>
nnoremap <leader>g :Commits<CR>
nnoremap <leader>H :Helptags<CR>
nnoremap <leader>hh :History<CR>
nnoremap <leader>h: :History:<CR>
nnoremap <leader>h/ :History/<CR>
" LSP Navigation
nnoremap <leader>ls :LspDiag show<CR>
nnoremap <leader>lk :LspHover<CR>
nnoremap <leader>ld :LspGotoDefinition<CR>
nnoremap <leader>lp :LspPeekDefinition<CR>
nnoremap <leader>lR :LspRename<CR>
nnoremap <leader>lr :LspPeekReferences<CR>
nnoremap <leader>lo :LspDocumentSymbol<CR>
nnoremap <leader>ll :LspCodeAction<CR>


" NERDTree
nnoremap <leader>t :NERDTreeToggle<CR>
" }}}

" LSP {{{
let lspServers = [
    \ #{ name: 'angular', filetype: 'html', path: $NVM_BIN . '/ngserver', args: ['--stdio', '--ngProbeLocations', $NVM_BIN . '/../lib/node_modules/@angular/language-service', '--tsProbeLocations', $NVM_BIN . '/typescript'] },
    \ #{ name: 'typescriptlang', filetype: ['javascript', 'typescript'], path: $NVM_BIN . '/typescript-language-server', args: ['--stdio'] },
    \ #{ name: 'latex', filetype: 'tex', path: '/opt/homebrew/bin/texlab' },
    \ #{ name: 'rustlang', filetype: 'rust', path: 'rust-analyzer', args: [], syncInit: v:true }
\ ]
autocmd VimEnter * call LspAddServer(lspServers)

let lspOptions = #{
    \ autoHighlight: v:true,
    \ completionTextEdit: v:true,
    \ noNewLineInCompletion: v:true,
    \ outlineOnRight: v:true,
    \ outlineWinSize: 70,
    \ autoPopulateDiags: v:true,
    \ showInlayHints: v:true,
    \ showDiagWithVirtualText: v:true,
    \ diagVirtualTextAligh: 'after',
    \ useQuickfixForLocations: v:true,	
    \ usePopupInCodeAction: v:true,
\ }
autocmd VimEnter * call LspOptionsSet(lspOptions)
" }}}

let g:rustfmt_autosave = 1

